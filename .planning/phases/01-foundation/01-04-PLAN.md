---
phase: 01-foundation
plan: 04
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/actions/organizations.ts
  - src/app/(admin)/admin/organizations/page.tsx
  - src/app/(admin)/admin/organizations/new/page.tsx
  - src/app/(admin)/admin/organizations/[id]/page.tsx
  - src/app/(admin)/admin/organizations/[id]/edit/page.tsx
  - src/app/(admin)/layout.tsx
  - src/components/organizations/org-form.tsx
  - src/components/organizations/org-list.tsx
autonomous: true

must_haves:
  truths:
    - "Super Admin can view list of all organizations"
    - "Super Admin can create new organization with name and slug"
    - "Super Admin can set organization branding (logo, colors)"
    - "Super Admin can mark organization as ProffsKontakt-affiliated"
    - "Super Admin can set installation partner cut for affiliated orgs"
  artifacts:
    - path: "src/actions/organizations.ts"
      provides: "Organization CRUD server actions"
      exports: ["createOrganization", "updateOrganization", "getOrganizations"]
    - path: "src/app/(admin)/admin/organizations/page.tsx"
      provides: "Organization list page"
      min_lines: 20
    - path: "src/components/organizations/org-form.tsx"
      provides: "Organization form component"
      contains: "useForm"
  key_links:
    - from: "src/app/(admin)/admin/organizations/new/page.tsx"
      to: "src/actions/organizations.ts"
      via: "form submission"
      pattern: "createOrganization"
    - from: "src/actions/organizations.ts"
      to: "src/lib/db/client.ts"
      via: "prisma import"
      pattern: "prisma\\.organization"
---

<objective>
Implement organization CRUD for Super Admin including branding and ProffsKontakt affiliation.

Purpose: Allow Super Admin to manage all organizations in the platform, set up branding, and configure ProffsKontakt partnership settings. Implements ORG-01 through ORG-05.

Output: Admin organization management pages with create/edit/list functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/research/ARCHITECTURE.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create organization server actions</name>
  <files>
    src/actions/organizations.ts
  </files>
  <action>
    Create server actions for organization CRUD with RBAC enforcement:

    ```typescript
    'use server';

    import { revalidatePath } from 'next/cache';
    import { z } from 'zod';
    import { prisma } from '@/lib/db/client';
    import { auth } from '@/lib/auth/auth';
    import { hasPermission, PERMISSIONS, Role } from '@/lib/auth/permissions';

    const organizationSchema = z.object({
      name: z.string().min(2, 'Namn maste vara minst 2 tecken').max(100),
      slug: z.string()
        .min(2)
        .max(50)
        .regex(/^[a-z0-9-]+$/, 'Slug kan bara innehalla smabokstaver, siffror och bindestreck'),
      logoUrl: z.string().url().optional().or(z.literal('')),
      primaryColor: z.string().regex(/^#[0-9A-Fa-f]{6}$/, 'Ogiltig fargkod').default('#3B82F6'),
      secondaryColor: z.string().regex(/^#[0-9A-Fa-f]{6}$/, 'Ogiltig fargkod').default('#1E40AF'),
      isProffsKontaktAffiliated: z.boolean().default(false),
      partnerCutPercent: z.number().min(0).max(100).optional(),
      marginAlertThreshold: z.number().min(0).max(100).optional(),
    });

    export type OrganizationFormData = z.infer<typeof organizationSchema>;

    export async function createOrganization(data: OrganizationFormData) {
      const session = await auth();
      if (!session?.user) {
        return { error: 'Ej inloggad' };
      }

      if (!hasPermission(session.user.role as Role, PERMISSIONS.ORG_CREATE)) {
        return { error: 'Du har inte behorighat att skapa organisationer' };
      }

      const parsed = organizationSchema.safeParse(data);
      if (!parsed.success) {
        return { error: parsed.error.errors[0].message };
      }

      // Check slug uniqueness
      const existingOrg = await prisma.organization.findUnique({
        where: { slug: parsed.data.slug },
      });
      if (existingOrg) {
        return { error: 'En organisation med denna slug finns redan' };
      }

      try {
        const org = await prisma.organization.create({
          data: {
            name: parsed.data.name,
            slug: parsed.data.slug,
            logoUrl: parsed.data.logoUrl || null,
            primaryColor: parsed.data.primaryColor,
            secondaryColor: parsed.data.secondaryColor,
            isProffsKontaktAffiliated: parsed.data.isProffsKontaktAffiliated,
            partnerCutPercent: parsed.data.isProffsKontaktAffiliated
              ? parsed.data.partnerCutPercent
              : null,
            marginAlertThreshold: parsed.data.marginAlertThreshold || null,
          },
        });

        revalidatePath('/admin/organizations');
        return { success: true, organizationId: org.id };
      } catch (error) {
        console.error('Failed to create organization:', error);
        return { error: 'Kunde inte skapa organisationen' };
      }
    }

    export async function updateOrganization(id: string, data: Partial<OrganizationFormData>) {
      const session = await auth();
      if (!session?.user) {
        return { error: 'Ej inloggad' };
      }

      const role = session.user.role as Role;
      const isSuperAdmin = hasPermission(role, PERMISSIONS.ORG_EDIT_ANY);
      const isOrgAdmin = hasPermission(role, PERMISSIONS.ORG_EDIT_OWN);

      // Org Admin can only edit their own org
      if (!isSuperAdmin && isOrgAdmin && session.user.orgId !== id) {
        return { error: 'Du kan bara redigera din egen organisation' };
      }

      if (!isSuperAdmin && !isOrgAdmin) {
        return { error: 'Du har inte behorighat att redigera organisationer' };
      }

      // Org Admin cannot change affiliation status or partner cut
      if (!isSuperAdmin && (data.isProffsKontaktAffiliated !== undefined || data.partnerCutPercent !== undefined)) {
        return { error: 'Endast Super Admin kan andra affiliatingstatus' };
      }

      try {
        await prisma.organization.update({
          where: { id },
          data: {
            ...data,
            logoUrl: data.logoUrl || null,
          },
        });

        revalidatePath('/admin/organizations');
        revalidatePath(`/admin/organizations/${id}`);
        return { success: true };
      } catch (error) {
        console.error('Failed to update organization:', error);
        return { error: 'Kunde inte uppdatera organisationen' };
      }
    }

    export async function getOrganizations() {
      const session = await auth();
      if (!session?.user) {
        return { error: 'Ej inloggad', organizations: [] };
      }

      if (!hasPermission(session.user.role as Role, PERMISSIONS.ORG_VIEW_ALL)) {
        return { error: 'Du har inte behorighat att se alla organisationer', organizations: [] };
      }

      const organizations = await prisma.organization.findMany({
        orderBy: { name: 'asc' },
        include: {
          _count: {
            select: { users: true },
          },
        },
      });

      return { organizations };
    }

    export async function getOrganization(id: string) {
      const session = await auth();
      if (!session?.user) {
        return { error: 'Ej inloggad' };
      }

      const role = session.user.role as Role;
      const canViewAll = hasPermission(role, PERMISSIONS.ORG_VIEW_ALL);
      const canViewOwn = session.user.orgId === id;

      if (!canViewAll && !canViewOwn) {
        return { error: 'Du har inte behorighat att se denna organisation' };
      }

      const organization = await prisma.organization.findUnique({
        where: { id },
        include: {
          users: {
            select: {
              id: true,
              name: true,
              email: true,
              role: true,
              isActive: true,
            },
          },
        },
      });

      if (!organization) {
        return { error: 'Organisationen hittades inte' };
      }

      return { organization };
    }
    ```
  </action>
  <verify>
    - Server actions compile without TypeScript errors
    - RBAC checks enforce Super Admin permission for org:create and org:view_all
    - Slug uniqueness is validated
  </verify>
  <done>Organization CRUD server actions with RBAC enforcement created</done>
</task>

<task type="auto">
  <name>Task 2: Create admin layout and organization list page</name>
  <files>
    src/app/(admin)/layout.tsx
    src/app/(admin)/admin/organizations/page.tsx
    src/components/organizations/org-list.tsx
  </files>
  <action>
    Create admin route group with organization management:

    **src/app/(admin)/layout.tsx:**
    ```typescript
    import { redirect } from 'next/navigation';
    import { auth } from '@/lib/auth/auth';
    import { hasPermission, PERMISSIONS, Role } from '@/lib/auth/permissions';

    export default async function AdminLayout({
      children,
    }: {
      children: React.ReactNode;
    }) {
      const session = await auth();

      if (!session?.user) {
        redirect('/login');
      }

      // Only Super Admin can access admin routes
      if (!hasPermission(session.user.role as Role, PERMISSIONS.ORG_VIEW_ALL)) {
        redirect('/dashboard');
      }

      return (
        <div className="min-h-screen bg-gray-50">
          <nav className="bg-white border-b border-gray-200">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between h-16">
                <div className="flex items-center">
                  <span className="text-xl font-semibold text-gray-900">
                    Kalkyla.se Admin
                  </span>
                </div>
                <div className="flex items-center space-x-4">
                  <a href="/admin/organizations" className="text-gray-600 hover:text-gray-900">
                    Organisationer
                  </a>
                  <span className="text-sm text-gray-500">
                    {session.user.name}
                  </span>
                </div>
              </div>
            </div>
          </nav>
          <main className="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            {children}
          </main>
        </div>
      );
    }
    ```

    **src/app/(admin)/admin/organizations/page.tsx:**
    ```typescript
    import { getOrganizations } from '@/actions/organizations';
    import { OrgList } from '@/components/organizations/org-list';
    import { Button } from '@/components/ui/button';
    import Link from 'next/link';

    export const metadata = {
      title: 'Organisationer - Kalkyla.se Admin',
    };

    export default async function OrganizationsPage() {
      const { organizations, error } = await getOrganizations();

      if (error) {
        return (
          <div className="text-red-600">
            {error}
          </div>
        );
      }

      return (
        <div>
          <div className="flex justify-between items-center mb-6">
            <h1 className="text-2xl font-bold text-gray-900">Organisationer</h1>
            <Link href="/admin/organizations/new">
              <Button>Skapa organisation</Button>
            </Link>
          </div>

          <OrgList organizations={organizations || []} />
        </div>
      );
    }
    ```

    **src/components/organizations/org-list.tsx:**
    ```typescript
    import Link from 'next/link';
    import { Card, CardContent } from '@/components/ui/card';

    interface Organization {
      id: string;
      name: string;
      slug: string;
      isProffsKontaktAffiliated: boolean;
      _count: {
        users: number;
      };
    }

    interface OrgListProps {
      organizations: Organization[];
    }

    export function OrgList({ organizations }: OrgListProps) {
      if (organizations.length === 0) {
        return (
          <Card>
            <CardContent className="text-center py-8 text-gray-500">
              Inga organisationer annu. Skapa den forsta!
            </CardContent>
          </Card>
        );
      }

      return (
        <div className="bg-white shadow rounded-lg overflow-hidden">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                  Namn
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                  Slug
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                  ProffsKontakt
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                  Anvandare
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                  Atgarder
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {organizations.map((org) => (
                <tr key={org.id}>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="text-sm font-medium text-gray-900">{org.name}</div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="text-sm text-gray-500">{org.slug}</div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    {org.isProffsKontaktAffiliated ? (
                      <span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        Ja
                      </span>
                    ) : (
                      <span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                        Nej
                      </span>
                    )}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {org._count.users}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm">
                    <Link
                      href={`/admin/organizations/${org.id}`}
                      className="text-blue-600 hover:text-blue-800"
                    >
                      Visa
                    </Link>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }
    ```
  </action>
  <verify>
    - Admin layout redirects non-Super Admin users
    - Organization list page renders table of organizations
    - Link to create new organization works
  </verify>
  <done>Admin layout and organization list page created with Super Admin access control</done>
</task>

<task type="auto">
  <name>Task 3: Create organization form and create/edit pages</name>
  <files>
    src/components/organizations/org-form.tsx
    src/app/(admin)/admin/organizations/new/page.tsx
    src/app/(admin)/admin/organizations/[id]/page.tsx
    src/app/(admin)/admin/organizations/[id]/edit/page.tsx
  </files>
  <action>
    Create organization form component and pages:

    **src/components/organizations/org-form.tsx:**
    ```typescript
    'use client';

    import { useForm } from 'react-hook-form';
    import { zodResolver } from '@hookform/resolvers/zod';
    import { z } from 'zod';
    import { useState, useTransition } from 'react';
    import { useRouter } from 'next/navigation';

    import { Button } from '@/components/ui/button';
    import { Input } from '@/components/ui/input';
    import { Label } from '@/components/ui/label';
    import { createOrganization, updateOrganization, OrganizationFormData } from '@/actions/organizations';

    const orgSchema = z.object({
      name: z.string().min(2, 'Namn maste vara minst 2 tecken'),
      slug: z.string().min(2).regex(/^[a-z0-9-]+$/, 'Endast smabokstaver, siffror och bindestreck'),
      logoUrl: z.string().url('Ogiltig URL').optional().or(z.literal('')),
      primaryColor: z.string().regex(/^#[0-9A-Fa-f]{6}$/),
      secondaryColor: z.string().regex(/^#[0-9A-Fa-f]{6}$/),
      isProffsKontaktAffiliated: z.boolean(),
      partnerCutPercent: z.coerce.number().min(0).max(100).optional(),
      marginAlertThreshold: z.coerce.number().min(0).max(100).optional(),
    });

    interface OrgFormProps {
      organization?: {
        id: string;
        name: string;
        slug: string;
        logoUrl: string | null;
        primaryColor: string;
        secondaryColor: string;
        isProffsKontaktAffiliated: boolean;
        partnerCutPercent: number | null;
        marginAlertThreshold: number | null;
      };
    }

    export function OrgForm({ organization }: OrgFormProps) {
      const [error, setError] = useState<string | null>(null);
      const [isPending, startTransition] = useTransition();
      const router = useRouter();
      const isEditing = !!organization;

      const {
        register,
        handleSubmit,
        watch,
        formState: { errors },
      } = useForm<OrganizationFormData>({
        resolver: zodResolver(orgSchema),
        defaultValues: organization ? {
          name: organization.name,
          slug: organization.slug,
          logoUrl: organization.logoUrl || '',
          primaryColor: organization.primaryColor,
          secondaryColor: organization.secondaryColor,
          isProffsKontaktAffiliated: organization.isProffsKontaktAffiliated,
          partnerCutPercent: organization.partnerCutPercent || undefined,
          marginAlertThreshold: organization.marginAlertThreshold || undefined,
        } : {
          primaryColor: '#3B82F6',
          secondaryColor: '#1E40AF',
          isProffsKontaktAffiliated: false,
        },
      });

      const isProffsKontakt = watch('isProffsKontaktAffiliated');

      const onSubmit = (data: OrganizationFormData) => {
        setError(null);
        startTransition(async () => {
          const result = isEditing
            ? await updateOrganization(organization.id, data)
            : await createOrganization(data);

          if (result.error) {
            setError(result.error);
          } else {
            router.push('/admin/organizations');
            router.refresh();
          }
        });
      };

      return (
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-6 max-w-xl">
          {error && (
            <div className="p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm">
              {error}
            </div>
          )}

          <div className="space-y-2">
            <Label htmlFor="name">Organisationsnamn *</Label>
            <Input id="name" {...register('name')} />
            {errors.name && <p className="text-sm text-red-600">{errors.name.message}</p>}
          </div>

          <div className="space-y-2">
            <Label htmlFor="slug">Slug (for URL) *</Label>
            <Input id="slug" {...register('slug')} placeholder="acme-solar" disabled={isEditing} />
            {errors.slug && <p className="text-sm text-red-600">{errors.slug.message}</p>}
            <p className="text-xs text-gray-500">Anvands i URL:er, t.ex. kalkyla.se/acme-solar/...</p>
          </div>

          <div className="border-t pt-6">
            <h3 className="text-lg font-medium mb-4">Varumärke</h3>

            <div className="space-y-2">
              <Label htmlFor="logoUrl">Logotyp URL</Label>
              <Input id="logoUrl" type="url" {...register('logoUrl')} placeholder="https://..." />
              {errors.logoUrl && <p className="text-sm text-red-600">{errors.logoUrl.message}</p>}
            </div>

            <div className="grid grid-cols-2 gap-4 mt-4">
              <div className="space-y-2">
                <Label htmlFor="primaryColor">Primarfarg</Label>
                <div className="flex gap-2">
                  <Input type="color" className="w-12 h-10 p-1" {...register('primaryColor')} />
                  <Input {...register('primaryColor')} />
                </div>
              </div>
              <div className="space-y-2">
                <Label htmlFor="secondaryColor">Sekundarfarg</Label>
                <div className="flex gap-2">
                  <Input type="color" className="w-12 h-10 p-1" {...register('secondaryColor')} />
                  <Input {...register('secondaryColor')} />
                </div>
              </div>
            </div>
          </div>

          <div className="border-t pt-6">
            <h3 className="text-lg font-medium mb-4">ProffsKontakt-affiliation</h3>

            <div className="flex items-center space-x-2">
              <input
                type="checkbox"
                id="isProffsKontaktAffiliated"
                className="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                {...register('isProffsKontaktAffiliated')}
              />
              <Label htmlFor="isProffsKontaktAffiliated">Affilierad med ProffsKontakt</Label>
            </div>

            {isProffsKontakt && (
              <div className="mt-4 space-y-4 pl-6 border-l-2 border-blue-200">
                <div className="space-y-2">
                  <Label htmlFor="partnerCutPercent">Partner-provision (%)</Label>
                  <Input
                    id="partnerCutPercent"
                    type="number"
                    min="0"
                    max="100"
                    step="0.1"
                    {...register('partnerCutPercent')}
                  />
                  <p className="text-xs text-gray-500">
                    Andel som gar till installationspartner
                  </p>
                </div>

                <div className="space-y-2">
                  <Label htmlFor="marginAlertThreshold">Marginal-varningsgrans (%)</Label>
                  <Input
                    id="marginAlertThreshold"
                    type="number"
                    min="0"
                    max="100"
                    step="0.1"
                    {...register('marginAlertThreshold')}
                  />
                  <p className="text-xs text-gray-500">
                    Skickar varning om marginalen understiger denna niva
                  </p>
                </div>
              </div>
            )}
          </div>

          <div className="flex gap-4 pt-4">
            <Button type="submit" disabled={isPending}>
              {isPending ? 'Sparar...' : isEditing ? 'Spara andringar' : 'Skapa organisation'}
            </Button>
            <Button type="button" variant="outline" onClick={() => router.back()}>
              Avbryt
            </Button>
          </div>
        </form>
      );
    }
    ```

    **src/app/(admin)/admin/organizations/new/page.tsx:**
    ```typescript
    import { OrgForm } from '@/components/organizations/org-form';

    export const metadata = {
      title: 'Skapa organisation - Kalkyla.se Admin',
    };

    export default function NewOrganizationPage() {
      return (
        <div>
          <h1 className="text-2xl font-bold text-gray-900 mb-6">Skapa ny organisation</h1>
          <OrgForm />
        </div>
      );
    }
    ```

    **src/app/(admin)/admin/organizations/[id]/page.tsx:**
    ```typescript
    import { notFound } from 'next/navigation';
    import Link from 'next/link';
    import { getOrganization } from '@/actions/organizations';
    import { Button } from '@/components/ui/button';
    import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

    export default async function OrganizationDetailPage({
      params,
    }: {
      params: Promise<{ id: string }>;
    }) {
      const { id } = await params;
      const { organization, error } = await getOrganization(id);

      if (error || !organization) {
        notFound();
      }

      return (
        <div className="space-y-6">
          <div className="flex justify-between items-center">
            <h1 className="text-2xl font-bold text-gray-900">{organization.name}</h1>
            <Link href={`/admin/organizations/${id}/edit`}>
              <Button>Redigera</Button>
            </Link>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <Card>
              <CardHeader>
                <CardTitle>Grunduppgifter</CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <div>
                  <span className="text-sm text-gray-500">Slug:</span>
                  <p className="font-medium">{organization.slug}</p>
                </div>
                <div>
                  <span className="text-sm text-gray-500">ProffsKontakt:</span>
                  <p className="font-medium">
                    {organization.isProffsKontaktAffiliated ? 'Ja' : 'Nej'}
                  </p>
                </div>
                {organization.isProffsKontaktAffiliated && organization.partnerCutPercent && (
                  <div>
                    <span className="text-sm text-gray-500">Partner-provision:</span>
                    <p className="font-medium">{organization.partnerCutPercent}%</p>
                  </div>
                )}
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle>Varumärke</CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <div className="flex items-center gap-2">
                  <span className="text-sm text-gray-500">Primarfarg:</span>
                  <div
                    className="w-6 h-6 rounded border"
                    style={{ backgroundColor: organization.primaryColor }}
                  />
                  <span className="font-mono text-sm">{organization.primaryColor}</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="text-sm text-gray-500">Sekundarfarg:</span>
                  <div
                    className="w-6 h-6 rounded border"
                    style={{ backgroundColor: organization.secondaryColor }}
                  />
                  <span className="font-mono text-sm">{organization.secondaryColor}</span>
                </div>
              </CardContent>
            </Card>
          </div>

          <Card>
            <CardHeader>
              <CardTitle>Anvandare ({organization.users.length})</CardTitle>
            </CardHeader>
            <CardContent>
              {organization.users.length === 0 ? (
                <p className="text-gray-500">Inga anvandare annu</p>
              ) : (
                <table className="min-w-full divide-y divide-gray-200">
                  <thead>
                    <tr>
                      <th className="text-left text-xs font-medium text-gray-500 uppercase py-2">Namn</th>
                      <th className="text-left text-xs font-medium text-gray-500 uppercase py-2">E-post</th>
                      <th className="text-left text-xs font-medium text-gray-500 uppercase py-2">Roll</th>
                      <th className="text-left text-xs font-medium text-gray-500 uppercase py-2">Status</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {organization.users.map((user) => (
                      <tr key={user.id}>
                        <td className="py-2">{user.name}</td>
                        <td className="py-2 text-gray-500">{user.email}</td>
                        <td className="py-2">{user.role}</td>
                        <td className="py-2">
                          {user.isActive ? (
                            <span className="text-green-600">Aktiv</span>
                          ) : (
                            <span className="text-red-600">Inaktiv</span>
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              )}
            </CardContent>
          </Card>
        </div>
      );
    }
    ```

    **src/app/(admin)/admin/organizations/[id]/edit/page.tsx:**
    ```typescript
    import { notFound } from 'next/navigation';
    import { getOrganization } from '@/actions/organizations';
    import { OrgForm } from '@/components/organizations/org-form';

    export default async function EditOrganizationPage({
      params,
    }: {
      params: Promise<{ id: string }>;
    }) {
      const { id } = await params;
      const { organization, error } = await getOrganization(id);

      if (error || !organization) {
        notFound();
      }

      return (
        <div>
          <h1 className="text-2xl font-bold text-gray-900 mb-6">
            Redigera {organization.name}
          </h1>
          <OrgForm organization={organization} />
        </div>
      );
    }
    ```
  </action>
  <verify>
    - Organization form validates all fields
    - Create page submits to createOrganization action
    - Edit page loads existing data and submits to updateOrganization
    - Detail page shows organization info and user list
  </verify>
  <done>Organization form and CRUD pages created with branding and ProffsKontakt settings</done>
</task>

</tasks>

<verification>
Run these checks after all tasks complete:

1. **Type checking:**
   ```bash
   npx tsc --noEmit
   ```

2. **Build verification:**
   ```bash
   npm run build
   ```

3. **Manual testing (requires Super Admin seed user):**
   - Navigate to /admin/organizations as Super Admin
   - Click "Skapa organisation" and fill out form
   - Verify organization appears in list
   - Click to view and edit organization

4. **RBAC verification:**
   - Attempt to access /admin/organizations as non-Super Admin
   - Should redirect to /dashboard
</verification>

<success_criteria>
- Super Admin can create organizations with all required fields
- Super Admin can set branding (logo, colors)
- Super Admin can configure ProffsKontakt affiliation and partner cut
- Organization list shows all organizations with user counts
- RBAC prevents non-Super Admin access to admin routes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
